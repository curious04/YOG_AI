{"version":3,"file":"index.js","sources":["../src/createContext.ts","../src/useLocalStorage.ts","../src/OnboardProvider.tsx","../src/OnboardElement.tsx"],"sourcesContent":["import React from 'react'\n\n/**\n * Type-safe createContext\n */\nexport const createContext = <ContextType>() => {\n  const Context = React.createContext<ContextType | undefined>(undefined)\n\n  const useContext = () => {\n    const value = React.useContext(Context)\n\n    if (value === undefined)\n      throw new Error('useContext must be used within a Provider with a value')\n\n    return value\n  }\n  return [useContext, Context.Provider] as const\n}\n","import { Dispatch, SetStateAction, useState, useEffect } from 'react'\n\nconst isClient = typeof window === 'object'\n\n/**\n * Set and get a value in local storage\n * Inspired by https://github.com/streamich/react-use/blob/master/src/useLocalStorage.ts\n */\nexport const useLocalStorage = <ValueType>(\n  key: string,\n  initialValue?: ValueType\n): [ValueType, Dispatch<SetStateAction<ValueType>>] => {\n  // Only get stored value first render\n  const [storedValue, setStoredValue] = useState(() => {\n    if (!isClient) {\n      return undefined\n    }\n\n    try {\n      const localStorageValue = window.localStorage.getItem(key)\n      // Parse stored JSON, or if none return initialValue\n      return localStorageValue === null\n        ? initialValue\n        : JSON.parse(localStorageValue)\n    } catch (error) {\n      console.error(error)\n      return initialValue\n    }\n  })\n\n  useEffect(() => {\n    try {\n      window.localStorage.setItem(key, JSON.stringify(storedValue))\n    } catch (error) {\n      // If user is in private mode or has storage restriction\n      // localStorage can throw. JSON.stringify can also throw.\n      console.error(error)\n    }\n  }, [storedValue])\n\n  return [storedValue, setStoredValue]\n}\n","import React, { useState, useEffect, FC } from 'react'\nimport { createContext } from './createContext'\nimport { useLocalStorage } from './useLocalStorage'\nimport { OnboardContext, Message, ShowCallback, AckCallback } from './types'\n\nconst [useOnboard, OnboardContextProvider] = createContext<OnboardContext>()\n\nconst useOnboardProvider = (\n  messages: Array<Message>,\n  showCallback: ShowCallback,\n  ackCallback: AckCallback,\n  HighlightComponent: any\n) => {\n  // Set of names of messages that have been seen\n  const [messagesAcked, setMessagesAcked] = useLocalStorage<Array<string>>(\n    `messagesAcked`,\n    []\n  )\n  // All elements currently rendered\n  const [renderedElements, setRenderedElements] = useState<Array<string>>([])\n  // Source of truth\n  const [activeMessage, setActiveMessage] = useState<Message | null>(null)\n\n  const ackMessage = (id: string) => {\n    // This is called twice in some configs because clicking element highlight calls it and then dismissing the message from that calls it again\n    if (id !== undefined && id !== null && !messagesAcked.includes(id)) {\n      setMessagesAcked([...messagesAcked, id])\n      return true\n    }\n    return false\n  }\n\n  // When a message is acked, execute ackCallback and then unset active message\n  useEffect(() => {\n    if (\n      activeMessage !== null &&\n      activeMessage.id === messagesAcked[messagesAcked.length - 1]\n    ) {\n      ackCallback({ messageId: activeMessage.id })\n      setActiveMessage(null)\n    }\n  }, [messagesAcked])\n\n  // When active message has been unset or a new element used in some message renders, show another\n  useEffect(() => {\n    // Tells us if one of the dependencies changed or component was unmounted to avoid race\n    let didCancel = false\n\n    if (activeMessage === null && !didCancel) {\n      messages\n        .filter(({ id }) => !messagesAcked.includes(id))\n        .some(({ id, children, elementIds, delay }) => {\n          const unrenderedElements = elementIds?.filter(\n            (elementId) => !renderedElements.includes(elementId)\n          )\n          // Show message if it has no associated elements or all are shown at the same time\n          if (\n            unrenderedElements === undefined ||\n            unrenderedElements.length === 0\n          ) {\n            setTimeout(\n              () => setActiveMessage({ id, elementIds, children }),\n              delay ?? 0\n            )\n            return true\n          }\n          return false\n        })\n    }\n\n    return () => {\n      didCancel = true\n    }\n  }, [activeMessage, renderedElements])\n\n  // When active message has been set, execute its showCallback\n  useEffect(() => {\n    if (activeMessage !== null) {\n      showCallback({\n        messageId: activeMessage.id,\n        children: activeMessage.children,\n        onAck: () => ackMessage(activeMessage.id)\n      })\n    }\n  }, [activeMessage])\n\n  return {\n    activeMessage,\n    onElementRender: (elementId: string) => {\n      if (!renderedElements.includes(elementId)) {\n        setRenderedElements((elements) => [...elements, elementId])\n      }\n    },\n    onElementUnrender: (elementId: string) => {\n      setRenderedElements((elements) =>\n        elements.filter((element) => element !== elementId)\n      )\n    },\n    ackMessage,\n    HighlightComponent\n  }\n}\n\nexport const OnboardProvider: FC<{\n  messages: Array<Message>\n  showCallback: ShowCallback\n  ackCallback: AckCallback\n  HighlightComponent: any\n}> = ({\n  children,\n  messages,\n  showCallback,\n  ackCallback,\n  HighlightComponent\n}) => {\n  const value = useOnboardProvider(\n    messages,\n    showCallback,\n    ackCallback,\n    HighlightComponent\n  )\n  return (\n    <OnboardContextProvider value={value}>{children}</OnboardContextProvider>\n  )\n}\n\nexport { useOnboard }\n","import React, { useState, useEffect, cloneElement, FC } from 'react'\nimport { useOnboard } from './OnboardProvider'\nimport { OnboardElementProps } from './types'\n\n/**\n * Wrapper for element to be highlighted with badge during an onboard message\n */\nexport const OnboardElement: FC<OnboardElementProps> = ({\n  id,\n  children,\n  ackOnClick = true,\n  ackOnMouseOver = 1000\n}) => {\n  const [isActive, setIsActive] = useState(false)\n  const {\n    onElementRender,\n    onElementUnrender,\n    activeMessage,\n    ackMessage,\n    HighlightComponent\n  } = useOnboard()\n\n  useEffect(() => {\n    onElementRender(id)\n\n    return () => onElementUnrender(id)\n  }, [])\n\n  useEffect(() => {\n    setIsActive(Boolean(activeMessage?.elementIds?.includes(id)))\n\n    return () => setIsActive(false)\n  }, [activeMessage])\n\n  const dismiss = () => {\n    if (isActive) ackMessage(activeMessage!.id!)\n  }\n\n  const [dismissTimeout, setDismissTimeout] = useState<number>()\n\n  const newChildren = cloneElement(children as any, {\n    ...(children as any).props,\n    style: { visibility: 'initial', ...(children as any).props.style }\n  })\n\n  return (\n    <HighlightComponent\n      onClick={() => {\n        if (ackOnClick) {\n          dismiss()\n          window.clearTimeout(dismissTimeout)\n          setDismissTimeout(undefined)\n        }\n      }}\n      onMouseOver={() => {\n        if (ackOnMouseOver > 0 && dismissTimeout === undefined)\n          setDismissTimeout(window.setTimeout(dismiss, ackOnMouseOver))\n      }}\n      onMouseLeave={() => {\n        if (ackOnMouseOver > 0) {\n          window.clearTimeout(dismissTimeout)\n          setDismissTimeout(undefined)\n        }\n      }}\n      style={{ visibility: isActive ? 'initial' : 'hidden' }}\n    >\n      {newChildren}\n    </HighlightComponent>\n  )\n}\n"],"names":["createContext","Context","React","undefined","useContext","value","Error","Provider","isClient","window","useLocalStorage","key","initialValue","useState","localStorageValue","localStorage","getItem","JSON","parse","error","console","storedValue","setStoredValue","useEffect","setItem","stringify","useOnboard","OnboardContextProvider","useOnboardProvider","messages","showCallback","ackCallback","HighlightComponent","messagesAcked","setMessagesAcked","renderedElements","setRenderedElements","activeMessage","setActiveMessage","ackMessage","id","includes","length","messageId","didCancel","filter","some","children","elementIds","delay","unrenderedElements","elementId","setTimeout","onAck","onElementRender","elements","onElementUnrender","element","OnboardProvider","OnboardElement","ackOnClick","ackOnMouseOver","isActive","setIsActive","Boolean","dismiss","dismissTimeout","setDismissTimeout","newChildren","cloneElement","props","style","visibility","onClick","clearTimeout","onMouseOver","onMouseLeave"],"mappings":"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"}